\documentclass[12pt,letterpaper]{article}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{longtable}
\author{Linyun Fu\\RIN: 660929569\\Email: fula@cs.rpi.edu}
\title{Assignment 3: Deadlocks}
\begin{document}
\maketitle
\part*{Question}
Consider the Dining Philosophers Problem in which N Philosophers
alternate between thinking and eating. Eating requires food
(consumable resource, food, is placed in the bowl at the center of
the table), and two chopsticks, a plate, and a seat (reusable
resources). Each philosopher has assigned a plate and a seat.
There are N chopsticks between seats on the round table, each
shared by two Philosophers assigned to adjacent seats.
Semaphores are used for synchronization, as follows:

\textbf{loopforever}

\hspace{3em}\textbf{Think}; left = rnd()$<$0.2;

\hspace{3em}if (left) P(chopstick[i\%N]); P(chopstick[i-1]);

\hspace{3em}else P(chopstick[i-1]); P(chopstick[i\%N]);

\hspace{3em}\textbf{Eat};

\hspace{3em}if (left) V(chopstick[i\%N]; V(chopstick[i-1]);

\hspace{3em}else V(chopstick[i-1]); V(chopstickl[i\%N]);

\textbf{end}

\section*{Basic Problem}
The written above implementation is starvation free but it is prone to deadlocks. Let $t_c$
denote the time it takes to acquire or check status of one chopstick (it takes 0 time
units to release a chopstick), $t_e$ denote the time (constant) of eating one portion of
food, and $t_l$ denote the maximum time that the Philosopher eats (so $t_l>t_e$). Each
Philosopher can see if the food is taken from the bowl at the center of the table,
but cannot see what other Philosophers do.

\textbf{Each sub-problem below is worth 5pts:}
\begin{itemize}
\item[a.] What is the probability that the deadlock arises in this system once all Philosophers
arrive for eating within at most $t_c$ time from each other?
\item[b.] How long a Philosopher has to wait to know for sure that the deadlock developed?
\item[c.] A strategy for distributed deadlock detection and recovery is for the Philosopher
holding a chopstick to wait for time $t_w = max(N\cdot t_c,t_e)$ and then give up his chopstick
and require it again (so if his neighbor is waiting for this chopstick, the neighbor will
be able to acquire it). What is the time that the system spends in deadlock when it
arises, and is this time increasing, decreasing or staying the same when the number
of Philosophers, N, increases? The system is not in a deadlock when at least one of
the Philosophers is trying to acquire a chopstick and is not denied it yet or it was
made available to her.
\end{itemize}

\section*{Bonus}
One method of deadlock prevention is to have $N-1$ seat tokens and requesting that
each Philosopher needs to get one token from the urn to pass to his seat, and
return this token back to the urn after eating. If no seat token is available in the
urn, the Philosopher must wait until somebody returns one.

\textbf{Each problem below is worth 2.5pts}
\begin{itemize}
\item[a.] Rewrite the Philosopher loop body to include this new synchronization. Carefully
define a new semaphore needed for this rewrite.
\item[b.] After seating in its table seat, the Philosopher can survive waiting for food
$t_d > 5\times(t_c+t_l)$ time. Find the maximum stable number of Philosophers that can
survive with this deadlock prevention method.
\end{itemize}

\part*{Answer}

\section*{Basic Problem}
\begin{itemize}
\item[a.] The deadlock arises when and only when each of the philosophers successfully acquires the chopstick on the same side, i.e., they are all left-handed or all right-handed. So the probability that the deadlock arises is
\begin{align}
P(deadlock) = 0.2^N + 0.8^N
\end{align}
\item[b.] This problem is equivalent to the following problem.
\begin{quote}
What is the longest time for a philosopher to acquire the second chopstick or to see food being eaten from the time she seats if the deadlock does not arise?
\end{quote}
After a philosopher seats at the table, it takes up to $N\cdot t_c$ time for all the N chopsticks to be grabbed, either by herself or other philosophers. If there is no deadlock, one or more philosophers will start eating at this time, so after another $t_e$ time, food will be taken and every one will know the deadlock is not happening. So the time a philosopher has to wait to know for sure the deadlock has developed is
\begin{align}
t_w = N\cdot t_c+t_e
\end{align}
after this amount of time, if still nothing happens, there must be a deadlock.
\item[c.] If this strategy is adopted, when a deadlock happens, it takes $t_w = max(N\cdot t_c,t_e)$ time for one or more philosophers to give up their chopsticks, which breaks the deadlock. So the time the system spends in deadlock is
\begin{align}
t_w = max(N\cdot t_c,t_e)
\end{align}
when $N\cdot t_c<t_e$, the time stays the same when N increases; after $N\cdot t_c\ge t_e$, the time increases when N increases.
\end{itemize}

\section*{Bonus}
\begin{itemize}
\item[a.] The modified program is as follows.

\textbf{loopforever}

\hspace{3em}\textbf{Think}; left = rnd()$<$0.2;

\hspace{3em}if (left) P(chopstick[i\%N]); P(chopstick[i-1]);

\hspace{3em}else P(chopstick[i-1]); P(chopstick[i\%N]);

\hspace{3em}\textbf{Eat};

\hspace{3em}if (left) V(chopstick[i\%N]; V(chopstick[i-1]);

\hspace{3em}else V(chopstick[i-1]); V(chopstickl[i\%N]);

\textbf{end}

\item[b.] $t_d > 5\times(t_c+t_l)$
\end{itemize}

\end{document}

